import { jsx as _jsx } from "react/jsx-runtime";
import { render } from "ink";
import { createRef, forwardRef, useImperativeHandle, useRef, useState } from "react";
import { ChatUI } from "./chat";
const ChatController = forwardRef((_, ref) => {
    const [messages, setMessages] = useState([]);
    const [input, setInput] = useState("");
    const listeners = useRef([]);
    const handleSubmit = (value) => {
        const message = value.trim();
        if (message.length === 0) {
            setInput("");
            return;
        }
        setMessages((prev) => [...prev, { role: "user", content: message }]);
        setInput("");
        listeners.current.forEach((listener) => {
            listener(message);
        });
    };
    const handleInputChange = (value) => {
        setInput(value);
    };
    const pushAssistantMessage = (message) => {
        const content = message.trim();
        if (content.length === 0) {
            return;
        }
        setMessages((prev) => [...prev, { role: "assistant", content }]);
    };
    useImperativeHandle(ref, () => ({
        onInput(action) {
            listeners.current.push(action);
        },
        sendMessage: pushAssistantMessage,
    }));
    return _jsx(ChatUI, { messages: messages, input: input, onInputChange: handleInputChange, onSubmit: handleSubmit });
});
export function renderChatUI() {
    const controllerRef = createRef();
    render(_jsx(ChatController, { ref: controllerRef }));
    return {
        onInput(action) {
            if (!controllerRef.current) {
                throw new Error("Chat UI is not ready to register input handlers.");
            }
            controllerRef.current.onInput(action);
        },
        sendMessage(message) {
            if (!controllerRef.current) {
                throw new Error("Chat UI is not ready to send messages.");
            }
            controllerRef.current.sendMessage(message);
        },
    };
}
//# sourceMappingURL=index.js.map